name: Lifetime Bot Automation

on:
  schedule:
    - cron: '0 10 * * 0-4'  # Runs at 10:00 AM from Sunday to Thursday
  workflow_dispatch:  # Allows manual trigger

jobs:
  run-bot:
    runs-on: ubuntu-latest

    env:
      HEADLESS: "true"
      RUN_ON_SCHEDULE: "false"
      TARGET_CLASS: "Pickleball"
      TARGET_INSTRUCTOR: "John Doe"
      TARGET_DATE: "2024-03-01"
      START_TIME: "9:00 PM"
      END_TIME: "10:00 PM"
      
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v3
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          pip install selenium webdriver-manager

      - name: Create .env File
        run: |
          echo "EMAIL_SENDER=${{ secrets.EMAIL_SENDER }}" >> .env
          echo "EMAIL_PASSWORD=${{ secrets.EMAIL_PASSWORD }}" >> .env
          echo "EMAIL_RECEIVER=${{ secrets.EMAIL_RECEIVER }}" >> .env
          echo "SMTP_SERVER=${{ secrets.SMTP_SERVER }}" >> .env
          echo "SMTP_PORT=\"${{ secrets.SMTP_PORT }}\"" >> .env
          echo "LIFETIME_USERNAME=${{ secrets.LIFETIME_USERNAME }}" >> .env
          echo "LIFETIME_PASSWORD=${{ secrets.LIFETIME_PASSWORD }}" >> .env
          echo "HEADLESS=${{ env.HEADLESS }}" >> .env
          echo "RUN_ON_SCHEDULE=${{ env.RUN_ON_SCHEDULE }}" >> .env
          echo "TARGET_CLASS=${{ env.TARGET_CLASS }}" >> .env
          echo "TARGET_INSTRUCTOR=${{ env.TARGET_INSTRUCTOR }}" >> .env
          echo "TARGET_DATE=${{ env.TARGET_DATE }}" >> .env
          echo "START_TIME=${{ env.START_TIME }}" >> .env
          echo "END_TIME=${{ env.END_TIME }}" >> .env

      - name: Debug Environment Variables
        run: env | grep TARGET_

      - name: Run Lifetime Bot
        run: python lifetime_bot.py
